<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <title>opencl-intro</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../../reveal.js/css/reveal.css">
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../../reveal.js/css/theme/black.css" id="theme">
  <!-- Printing and PDF exports -->
  <script>
    var link = document.createElement( 'link' );
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match( /print-pdf/gi ) ? '../../reveal.js/css/print/pdf.css' : '../../reveal.js/css/print/paper.css';
    document.getElementsByTagName( 'head' )[0].appendChild( link );
  </script>
  <!--[if lt IE 9]>
  <script src="../../reveal.js/lib/js/html5shiv.js"></script>
  <![endif]-->
</head>
<body>
  <div class="reveal">
    <div class="slides">


<section><section id="opencl-exercise" class="title-slide slide level1"><h1>OpenCL Exercise</h1></section><section id="introduction" class="slide level2">
<h2>Introduction</h2>
<p>Navigate to find the template source code in <code>exercises/opencl_intro/intro.c</code>. There should be an accompanying kernel template <code>kernel.c</code>.</p>
<p>The template source file is marked with the sections to be edited, e.g.</p>
<p><code> /* Part 1A: allocate device memory */ </code></p>
<p>Please read on for instructions. Where necessary, it may be helpful to refer to the OpenCL reference guide <a href="https://www.khronos.org/files/opencl22-reference-guide.pdf" class="uri">https://www.khronos.org/files/opencl22-reference-guide.pdf</a></p>
</section><section id="copying-between-host-and-device" class="slide level2">
<h2>1) Copying Between Host and Device</h2>
<p>The exercise is a simple example in which an array of integers is multiplied by a constant (-1). This should allow you to contrast two approaches: OpenCL and CUDA.</p>
<p>In the OpenCL template <code>intro.c</code>, some of the platform and device management has been provided so that you should be able to concentrate on device memory allocation, transfer between host and device, and the kernel itself.</p>
<p>Starting from the <code>intro.c</code> template:</p>
<ul>
<li><p>1A) Allocate memory for the array on the device using <code>clCreateBuffer()</code>. The appropriate device reference is <code>d_a</code> (check its declaration). You will need to identify the OpenCL context and the size of allocation (<code>sz</code>). Check the OpenCL reference card for the arguments to <code>clBufferCreate()</code> if unsure.</p></li>
<li><p>1B) Copy the array <code>h_a</code> on the host to <code>d_a</code> on the device. The OpenCL command queue is varaible <code>queue</code>.</p></li>
<li><p>1C) Copy <code>d_a</code> on the device back to <code>h_out</code> on the host.</p></li>
<li><p>1D) Release the device memory <code>d_a</code>.</p></li>
</ul>
<h3 id="compile-and-run-the-code">Compile and run the code</h3>
<p>Note here we are using <code>nvcc</code> to compile and OpenCL program. We must also specify that the executable is linked against the OpenCL library via <code>-lOpenCL</code> on this system.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># Execute this command to compile the code.</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2">$ <span class="fu">make</span></a></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co"># Execute this command to submit the job to the queue system.</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">$ <span class="ex">qsub</span> submit.sh</a></code></pre></div>
</section><section class="slide level2">

<p>The output (the contents of the <code>h_out</code> array) or any error messages will be printed as output. So far the code simply copies from <code>h_a</code> on the host to <code>d_a</code> on the device, and then copies <code>d_a</code> back to <code>h_out</code>, so the output should be the initial content of <code>h_a</code>, that is, the numbers 0 to 255.</p>
</section><section id="executing-the-kernel" class="slide level2">
<h2>2) Executing the Kernel</h2>
<p>Now we will extend the <code>intro.c</code> file to run the kernel.</p>
<ul>
<li><p>2A) Configure the global number of work items and the local number of work items for this problem. Note that the number of items per work group has been assigned as a constant to <code>THREADS_PER_WORK_GROUP</code>. You will need to declare the kernel argument, and execute it with the appropriate OpenCL calls.</p></li>
<li><p>2B) Look at kernel template <code>kernel.c</code>. Implement the computation required (multiply each element of the array by -1) using the OpenCL function <code>get_global_id()</code></p></li>
</ul>
<p>Compile and run the code by executing the commands above as before. This time the output should contain the result of negating each element of the input array. Because the array is initialised to the numbers 0 to 255, you should see the numbers 0 to -255 printed.</p>
</section><section class="slide level2">

<h3 id="additional-tasks">Additional tasks</h3>
<ul>
<li><p>(If you havenâ€™t found out yet.) What happens if you introduce a programming (compilation) error into the kernel code? Where is the error message coming from?</p></li>
<li><p>Look through the rest of the template <code>intro.c</code> to see what is required to initise OpenCL and read in the kernel.</p></li>
</ul>
<h3 id="keeping-a-copy-of-your-work">Keeping a copy of your work</h3>
<p>The templates for the exercise and a solution are provided in the course repository.</p>
<p>If you wish to keep a copy of your particular soultion, please use the <code>scp</code> command to obtain a copy of the relevant files.</p>
<style>
p.hint_trigger{
  margin-bottom:7px;
  margin-top:-5px;
  background:#64E84D;
}
.toggle_container{
  margin-bottom:0px;
}
.toggle_container p{
  margin:2px;
}
.toggle_container{
  background:#f0f0f0;
  clear: both;
  font-size:100%;
}
</style>
<script>
$("p.hint_trigger").click(function(){
   $(this).toggleClass("active").next().slideToggle("normal");
});
   
$(".toggle_container").hide();
</script>
</section></section>
    </div>
  </div>

  <script src="../../reveal.js/lib/js/head.min.js"></script>
  <script src="../../reveal.js/js/reveal.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        // Push each slide change to the browser history
        history: true,
        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // Optional reveal.js plugins
        dependencies: [
          { src: '../../reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: '../../reveal.js/plugin/zoom-js/zoom.js', async: true },
          { src: '../../reveal.js/plugin/math/math.js', async: true },
          { src: '../../reveal.js/plugin/notes/notes.js', async: true }
        ]
      });
    </script>
    </body>
</html>
